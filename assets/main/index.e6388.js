window.__require=function e(i,t,o){function n(c,a){if(!t[c]){if(!i[c]){var r=c.split("/");if(r=r[r.length-1],!i[r]){var h="function"==typeof __require&&__require;if(!a&&h)return h(r,!0);if(s)return s(r,!0);throw new Error("Cannot find module '"+c+"'")}c=r}var d=t[c]={exports:{}};i[c][0].call(d.exports,function(e){return n(i[c][1][e]||e)},d,d.exports,e,i,t,o)}return t[c].exports}for(var s="function"==typeof __require&&__require,c=0;c<o.length;c++)n(o[c]);return n}({AnimationPlayer:[function(e,i){"use strict";cc._RF.push(i,"bab535F10ZK2Iewm/5XRlif","AnimationPlayer"),cc.Class({extends:cc.Component,properties:{bodySpriteNode:cc.Node,shadowSpriteNode:cc.Node,framePath:"",frameRate:12},onLoad:function(){this.bodyFrames=[],this.shadowFrames=[],this._bodyIndex=0,this._shadowIndex=0,this._timer=0,this._isPlaying=!1,this._isPlayingOnce=!1,this._frameInterval=1/this.frameRate,this.bodySprite=this.bodySpriteNode.getComponent(cc.Sprite),this.shadowSprite=this.shadowSpriteNode.getComponent(cc.Sprite),this._loadFrames()},_loadFrames:function(){var e=this;cc.resources.loadDir(this.framePath,cc.SpriteFrame,function(i,t){i?console.error("\u52a0\u8f7d\u5e8f\u5217\u5e27\u5931\u8d25:",i):(t.forEach(function(i){var t=i.name;t.startsWith("body_")?e.bodyFrames.push(i):t.startsWith("shadow_")&&e.shadowFrames.push(i)}),e.bodyFrames.sort(function(e,i){return e.name.localeCompare(i.name)}),e.shadowFrames.sort(function(e,i){return e.name.localeCompare(i.name)}),e.shadowSprite.srcBlendFactor=cc.macro.BlendFactor.DST_COLOR,e.shadowSprite.dstBlendFactor=cc.macro.BlendFactor.ZERO,e.shadowSprite._updateBlendFunc(),"pic/game/grandMa"!==e.framePath&&e.play())})},play:function(){this._isPlaying=!0,this._timer=0,this._bodyIndex=0,this._shadowIndex=0,this._isPlayingOnce=!1},playOnce:function(e){var i=e.onFrame,t=e.onComplete;this._isPlaying=!0,this._onFrameCallback=i,this._onCompleteCallback=t,this._timer=0,this._bodyIndex=0,this._shadowIndex=0,this._isPlayingOnce=!0},pause:function(){this._isPlaying=!1},resume:function(){this._isPlaying=!0},update:function(e){this._isPlaying&&(this._timer+=e,this._timer>=this._frameInterval&&(this._timer=0,this.bodyFrames.length>0&&(this._isPlayingOnce&&this._bodyIndex>=this.bodyFrames.length?this.bodySprite.spriteFrame=this.bodyFrames[this.bodyFrames.length-1]:(this.bodySprite.spriteFrame=this.bodyFrames[this._bodyIndex],this._bodyIndex=this._isPlayingOnce?this._bodyIndex+1:(this._bodyIndex+1)%this.bodyFrames.length)),this.shadowFrames.length>0&&(this._isPlayingOnce&&this._shadowIndex>=this.shadowFrames.length?this.shadowSprite.spriteFrame=this.shadowFrames[this.shadowFrames.length-1]:(this.shadowSprite.spriteFrame=this.shadowFrames[this._shadowIndex],this._shadowIndex=this._isPlayingOnce?this._shadowIndex+1:(this._shadowIndex+1)%this.shadowFrames.length)),this._isPlayingOnce))&&(this._bodyIndex,this.bodyFrames.length,this._shadowIndex,this.shadowFrames.length,this._bodyIndex>=3&&this._bodyIndex<8&&"function"==typeof this._onFrameCallback&&this._onFrameCallback(this._bodyIndex)&&(this._onFrameCallback=null),this._bodyIndex>=this.bodyFrames.length&&("function"==typeof this._onCompleteCallback&&this._onCompleteCallback(),this._isPlaying=!1))}}),cc._RF.pop()},{}],ResourceManager:[function(e,i){"use strict";cc._RF.push(i,"c739cAbkXRB855VYHTGaEfz","ResourceManager");var t={isLoaded:!1,isLoading:!1,preloadList:["pic/game/dog","pic/game/girl","pic/game/grandMa","music/bgm","music/hit","pic/finish/1","pic/finish/2","videos/loading"],preloadGameResources:function(e){var i=this;if(this.isLoaded)e&&e();else if(!this.isLoading){this.isLoading=!0;var t=this.preloadList.length,o=0;this.preloadList.forEach(function(n){cc.resources.loadDir(n,function(s,c){s?console.error("\u52a0\u8f7d\u5931\u8d25\uff1a"+n,s):(console.log("\u9884\u52a0\u8f7d\u5b8c\u6210\uff1a"+n+"\uff08"+c.length+"\u9879\uff09"),++o===t&&(i.isLoaded=!0,i.isLoading=!1,console.log("\u6240\u6709\u8d44\u6e90\u52a0\u8f7d\u5b8c\u6210!"),e&&e()))})})}}};i.exports=t,cc._RF.pop()},{}],TransitionManager:[function(e,i){"use strict";cc._RF.push(i,"37af2ZDITpMp7ROUyoNKEET","TransitionManager"),cc.Class({extends:cc.Component,properties:{fadeNode:cc.Node,fadeDuration:.1},fadeIn:function(e){var i=this;this.fadeNode.active=!0,this.fadeNode.opacity=200,cc.tween(this.fadeNode).to(this.fadeDuration,{opacity:0}).call(function(){i.fadeNode.active=!1,e&&e()}).start()},fadeOut:function(e){this.fadeNode.active=!0,this.fadeNode.opacity=0,cc.tween(this.fadeNode).to(this.fadeDuration,{opacity:200}).call(function(){e&&e()}).start()},transitionToScene:function(e){this.fadeOut(function(){cc.director.loadScene(e,function(){var e=cc.find("Canvas/TransitionLayer");e&&e.getComponent("TransitionManager").fadeIn()})})}}),cc._RF.pop()},{}],chooseScene:[function(e,i){"use strict";cc._RF.push(i,"5cf52OSuJhN8YItCZK7+DO1","chooseScene"),cc.Class({extends:cc.Component,properties:{playButton:cc.Node,TransitionLayer:cc.Node},onLoad:function(){cc.tween(this.playButton).repeatForever(cc.tween().to(.25,{angle:7},{easing:"sineOut"}).to(.25,{angle:-7},{easing:"sineInOut"}).to(.2,{angle:0},{easing:"sineIn"})).start(),this.playButton.on("click",function(){var e=cc.find("Canvas/TransitionLayer");e?e.getComponent("TransitionManager").transitionToScene("loadingScene"):cc.director.loadScene("loadingScene")})},_preloadGameResources:function(){["videos/loading"].forEach(function(e){cc.resources.loadDir(e,cc.Asset,function(i,t){i?console.error("\u9884\u52a0\u8f7d "+e+" \u5931\u8d25",i):console.log("\u9884\u52a0\u8f7d\u5b8c\u6210\uff1a"+e,t.length)})})}}),cc._RF.pop()},{}],finishScene:[function(e,i){"use strict";cc._RF.push(i,"a8512wCohpJ0o13CHILAez+","finishScene"),cc.Class({extends:cc.Component,properties:{finishNode:cc.Node},onLoad:function(){this._sprite=this.finishNode.getComponent(cc.Sprite),this._imagePaths=["pic/finish/1","pic/finish/2"],this._imageIndex=0,this._loopCount=0,this._maxLoops=3,this._startSequence()},_startSequence:function(){this._playNextFrame()},_playNextFrame:function(){var e=this,i=this._imagePaths[this._imageIndex%2];cc.resources.load(i,cc.SpriteFrame,function(t,o){t?console.error("\u52a0\u8f7d\u56fe\u7247\u5931\u8d25\uff1a"+i,t):(e._sprite.spriteFrame=o,e._imageIndex++,e._imageIndex>=2*e._maxLoops?(console.log("\u64ad\u653e\u5b8c3\u6b21\uff0c\u51c6\u5907\u8fdb\u5165 chooseScene"),e._enterChooseScene()):e.scheduleOnce(e._playNextFrame.bind(e),.5))})},_enterChooseScene:function(){cc.director.loadScene("mainScene")}}),cc._RF.pop()},{}],fitSize:[function(e,i){"use strict";cc._RF.push(i,"6d11a+ucW5JOp/MhRY5CxzY","fitSize"),cc.Class({extends:cc.Component,properties:{designWidth:1920,designHeight:1080},onLoad:function(){this.adaptToScreen()},adaptToScreen:function(){var e=cc.Canvas.instance,i=cc.view.getFrameSize();i.width/i.height>this.designWidth/this.designHeight?(e.fitHeight=!0,e.fitWidth=!1,console.log("\u5c4f\u5e55\u504f\u5bbd\uff0c\u4f7f\u7528\u9ad8\u5ea6\u9002\u914d")):(e.fitHeight=!1,e.fitWidth=!0,console.log("\u5c4f\u5e55\u504f\u7a84\uff0c\u4f7f\u7528\u5bbd\u5ea6\u9002\u914d")),cc.view.setDesignResolutionSize(this.designWidth,this.designHeight,cc.ResolutionPolicy.EXACT_FIT)}}),cc._RF.pop()},{}],gameScene:[function(e,i){"use strict";cc._RF.push(i,"14e91RxabVEq5K0+oFhS7BU","gameScene"),cc.Class({extends:cc.Component,properties:{girlBody:cc.Node,girlShadow:cc.Node,grandmaBody:cc.Node,grandmaShadow:cc.Node,dogBody:cc.Node,dogShadow:cc.Node,mochiNode:cc.Prefab,mochiShowNode:cc.Node,grandmaCtrl:cc.Node,onsetJson:cc.JsonAsset,bgmAudio:cc.AudioClip,hitAudio:cc.AudioClip,scoreNode:cc.Label},onLoad:function(){cc.systemEvent.on(cc.SystemEvent.EventType.KEY_DOWN,this.onKeyDown,this),cc.systemEvent.on(cc.SystemEvent.EventType.KEY_UP,this.onKeyUp,this),this.node.on(cc.Node.EventType.TOUCH_START,this.onTouchStart,this),this._initAnimation(this.girlBody,"pic/game/girl/body"),this._initAnimation(this.girlShadow,"pic/game/girl/shadow"),this._initAnimation(this.dogBody,"pic/game/dog/body"),this._initAnimation(this.dogShadow,"pic/game/dog/shadow"),this._initAnimation(this.grandmaCtrl,"pic/game/grandMa"),this.mochiList=[],this.currentIndex=0,this.timer=0,this.onsets=this.onsetJson.json.onsets,this.spawnLeadTime=2,this.isPlayingMusic=!1,this.playBGM(),this.score=0,this.scoreNode.string=this.score.toString()},onKeyDown:function(e){e.keyCode===cc.macro.KEY.space&&(this.isSpacePressed=!0)},onKeyUp:function(e){e.keyCode===cc.macro.KEY.space&&(this.isSpacePressed=!1)},onTouchStart:function(){this.tryHit()},playBGM:function(){this.isPlayingMusic=!0,this.bgmId=cc.audioEngine.play(this.bgmAudio,!1,1),this.hitId=cc.audioEngine.play(this.hitAudio,!1,1),cc.audioEngine.setFinishCallback(this.bgmId,function(){cc.log("\u80cc\u666f\u97f3\u4e50\u64ad\u653e\u5b8c\u6bd5\uff0c\u8fdb\u5165 finishScene"),cc.director.loadScene("finishScene")})},_initAnimation:function(e,i){var t=e.getComponent("AnimationPlayer");t&&(t.framePath=i)},_pauseOrResumeAll:function(e){[this.girlBody,this.girlShadow,this.grandmaBody,this.grandmaShadow,this.dogBody,this.dogShadow].forEach(function(i){var t=i.getComponent("AnimationPlayer");t&&"function"==typeof t[e]&&t[e]()})},update:function(e){if(this.isPlayingMusic){this.timer+=e;for(var i=cc.audioEngine.getCurrentTime(this.bgmId);this.currentIndex<this.onsets.length&&i>=this.onsets[this.currentIndex]-this.spawnLeadTime;)this.spawnMochi(this.onsets[this.currentIndex]),this.currentIndex++}},spawnMochi:function(){var e=this,i=cc.instantiate(this.mochiNode),t=i.getComponent("mochi");if(!t)return cc.error("\u9884\u5236\u4f53\u672a\u6302\u8f7d mochi \u7ec4\u4ef6\uff01"),void i.destroy();i.y=540+i.height/2,i.x=0,this.mochiShowNode.addChild(i),t.init(function(t){e.onMochiResult(t,i)}),this.mochiList.push(i)},tryHit:function(){var e=this;this.grandmaCtrl.getComponent("AnimationPlayer").playOnce({onFrame:function(i){return i>=3&&i<7&&e.showHitOnMochi()},onComplete:function(){console.log("\u52a8\u753b\u64ad\u653e\u5b8c\u6bd5")}})},showHitOnMochi:function(){for(var e=!1,i=0;i<this.mochiList.length;i++){var t=this.mochiList[i];if(t&&t.isValid){var o=t.getComponent("mochi");if(o&&o.tryHit()){console.log("mochiHit!"),o.hitShow(),e=!0;break}}}return e},onMochiResult:function(e,i){var t=this.mochiList.indexOf(i);if(-1!==t&&this.mochiList.splice(t,1),"hit"===e){this.score++,this.scoreNode.string=this.score.toString(),this.scoreNode.node.stopAllActions(),this.scoreNode.node.scale=1;var o=cc.scaleTo(.1,1.4),n=cc.scaleTo(.1,1),s=cc.sequence(o,n);this.scoreNode.node.runAction(s)}else"miss"===e?(this.score=0,this.scoreNode.string=this.score.toString(),console.log("Miss!"),i&&i.isValid&&(i.active=!1,i.destroy())):"finish"===e&&(console.log("finish!"),i&&i.isValid&&(i.active=!1,i.destroy()))},onDestroy:function(){void 0!==this.bgmId&&cc.audioEngine.stop(this.bgmId),void 0!==this.hitId&&cc.audioEngine.stop(this.hitId),cc.systemEvent.off(cc.SystemEvent.EventType.KEY_DOWN,this.onKeyDown,this),cc.systemEvent.off(cc.SystemEvent.EventType.KEY_UP,this.onKeyUp,this),this.node.off(cc.Node.EventType.TOUCH_START,this.onTouchStart,this),this.unschedule(this.checkBgmFinished)}}),cc._RF.pop()},{}],loadingScene:[function(e,i){"use strict";cc._RF.push(i,"33bba5Wn4BJn5k5BV1Lj4FQ","loadingScene");var t=e("ResourceManager");cc.Class({extends:cc.Component,properties:{videoPath:"videos/loading",transitionNode:cc.Node},onLoad:function(){this._isResourcesLoaded=!1,this._hasEntered=0,this._playLoopingVideo(),t.isLoaded?this._isResourcesLoaded=!0:t.preloadGameResources(function(){console.log("loadingScene \u4e2d\u5b8c\u6210\u4e86\u8d44\u6e90\u52a0\u8f7d\uff01")})},_playLoopingVideo:function(){var e=this;cc.resources.load(this.videoPath,cc.VideoClip,function(i,o){if(i)console.error("\u52a0\u8f7d\u89c6\u9891\u5931\u8d25",i);else{var n=new cc.Node("DynamicVideo"),s=n.addComponent(cc.VideoPlayer);s.clip=o,s.resourceType=cc.VideoPlayer.ResourceType.LOCAL,s.keepAspectRatio=!0,s.stayOnBottom=!1,s.loop=!0,n.width=cc.winSize.width,n.height=cc.winSize.height,n.setPosition(0,0),e.node.addChild(n),s.node.on("completed",function(){console.log("\u89c6\u9891\u64ad\u653e\u5b8c\u4e00\u8f6e"),e._hasEntered++,(e._isResourcesLoaded||t.isLoaded)&&3==e._hasEntered?(console.log("\u89c6\u9891\u64ad\u653e\u5b8c\u4e00\u8f6e && \u8d44\u6e90\u52a0\u8f7d\u5b8c\u6210\uff0c\u51c6\u5907\u8fdb\u5165\u6e38\u620f\uff01"),e._hasEntered=0,e._enterGameScene()):s.play()}),s.play()}})},_preloadGameResources:function(){var e=this,i=["pic/game/dog","pic/game/girl","pic/game/grandMa","music/bgm","music/hit"],t=i.length,o=0;i.forEach(function(i){cc.resources.loadDir(i,function(n,s){n?console.error("\u52a0\u8f7d\u5931\u8d25\uff1a"+i,n):(console.log("\u9884\u52a0\u8f7d\u5b8c\u6210\uff1a"+i+"\uff08"+s.length+"\u9879\uff09"),++o===t&&(console.log("\u6240\u6709\u8d44\u6e90\u52a0\u8f7d\u5b8c\u6210\uff01"),e._isResourcesLoaded=!0))})})},_enterGameScene:function(){if(this.transitionNode){var e=this.transitionNode.getComponent("TransitionManager");if(e)return void e.transitionToScene("gameScene")}cc.director.loadScene("gameScene")}}),cc._RF.pop()},{ResourceManager:"ResourceManager"}],mainScene:[function(e,i){"use strict";cc._RF.push(i,"280c3rsZJJKnZ9RqbALVwtK","mainScene"),cc.Class({extends:cc.Component,properties:{title:cc.Node,showNode:cc.Node,startBtn:cc.Button},onLoad:function(){this.startBtn.node.on("click",this.onStartGame,this),cc.tween(this.title).repeatForever(cc.tween().to(1.2,{y:this.title.y+15},{easing:"sineInOut"}).to(1.2,{y:this.title.y-15},{easing:"sineInOut"})).start(),this.showNode.opacity=180,cc.tween(this.showNode).repeatForever(cc.tween().to(.8,{x:this.showNode.x+3},{easing:"sineInOut"}).to(.8,{x:this.showNode.x-3},{easing:"sineInOut"}).to(.8,{y:this.showNode.y+3},{easing:"sineInOut"}).to(.8,{y:this.showNode.y-3},{easing:"sineInOut"})).start();var e=this.startBtn.node;cc.tween(e).repeatForever(cc.tween().to(.25,{angle:3},{easing:"sineOut"}).to(.25,{angle:-3},{easing:"sineInOut"}).to(.2,{angle:0},{easing:"sineIn"})).start()},onStartGame:function(){var e=cc.find("Canvas/TransitionLayer");e?e.getComponent("TransitionManager").transitionToScene("chooseScene"):cc.director.loadScene("chooseScene")}}),cc._RF.pop()},{}],mochi:[function(e,i){"use strict";cc._RF.push(i,"8ffccMhszVGhI6+CSop4oc4","mochi"),cc.Class({extends:cc.Component,properties:{sprite:cc.Sprite,hitAnimFrames:{default:[],type:cc.SpriteFrame},speed:220,hitRange:20,hitY:-320},onLoad:function(){this.isHit=!1,this.callback=null,this._currentFrame=0,this._isPlayingHitAnim=!1},init:function(e){this.callback=e},update:function(e){if(this.node.y-=this.speed*e,this._isPlayingHitAnim){this._currentFrame+=12*e;var i=Math.floor(this._currentFrame);return i>=this.hitAnimFrames.length?(this._isPlayingHitAnim=!1,void(this.callback&&this.callback("finish",this.node))):void(this.sprite.spriteFrame=this.hitAnimFrames[i])}this.node.y<=this.hitY-this.hitRange&&(this.isHit=!0,this.callback&&this.callback("miss",this.node))},tryHit:function(){return!this.isHit&&Math.abs(this.node.y-this.hitY)<=this.hitRange&&(this.isHit=!0,this.callback&&this.callback("hit",this.node),!0)},hitShow:function(){this._isPlayingHitAnim=!0,this._currentFrame=0}}),cc._RF.pop()},{}],pvScene:[function(e,i){"use strict";cc._RF.push(i,"abce10RBiZJdaynk27QUUjh","pvScene");var t=e("ResourceManager"),o=["mainScene","gameScene","chooseScene","pvScene","loadingScene"];cc.Class({extends:cc.Component,properties:{spriteNode:cc.VideoPlayer,coverNode:cc.Node},onLoad:function(){this.coverNode.active=!0,this.node.on(cc.Node.EventType.TOUCH_START,this.onTouchStart,this),this.spriteNode.node.on("completed",this.onVideoFinished,this),t.preloadGameResources(),o.forEach(function(e){cc.director.preloadScene(e,function(){cc.log(e+" \u573a\u666f\u9884\u52a0\u8f7d\u5b8c\u6210\uff01")})})},onTouchStart:function(e){var i=this;e.stopPropagation(),cc.log("\u70b9\u51fb\u5df2\u6355\u83b7",e.getLocation()),this.spriteNode.stayOnBottom=!0,cc.log("\u70b9\u51fb\u89c6\u9891"),this.node.off(cc.Node.EventType.TOUCH_START,this.onTouchStart,this),cc.resources.load("videos/pv",cc.VideoClip,function(e,t){if(e)console.error("\u52a0\u8f7d\u89c6\u9891\u5931\u8d25",e);else{var o=new cc.Node("DynamicVideo"),n=o.addComponent(cc.VideoPlayer);n.clip=t,n.resourceType=cc.VideoPlayer.ResourceType.LOCAL,n.stayOnBottom=!1,n.keepAspectRatio=!1,n.currentTime=0,o.width=cc.winSize.width,o.height=cc.winSize.height,o.setPosition(0,0),i.node.addChild(o),i.scheduleOnce(function(){try{i.coverNode.active=!1,cc.log("\u64ad\u653e\u89c6\u9891"),n.play()}catch(e){console.warn("\u64ad\u653e\u5f02\u5e38\uff1a",e),cc.director.loadScene("mainScene")}},.1),o.on("completed",function(){cc.director.loadScene("mainScene")})}})},onVideoFinished:function(){console.log("\u89c6\u9891\u64ad\u653e\u5b8c\u6bd5"),cc.director.loadScene("mainScene")}}),cc._RF.pop()},{ResourceManager:"ResourceManager"}]},{},["AnimationPlayer","ResourceManager","TransitionManager","chooseScene","finishScene","fitSize","gameScene","loadingScene","mainScene","mochi","pvScene"]);