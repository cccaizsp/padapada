window.__require=function t(e,i,n){function s(a,c){if(!i[a]){if(!e[a]){var r=a.split("/");if(r=r[r.length-1],!e[r]){var h="function"==typeof __require&&__require;if(!c&&h)return h(r,!0);if(o)return o(r,!0);throw new Error("Cannot find module '"+a+"'")}a=r}var d=i[a]={exports:{}};e[a][0].call(d.exports,function(t){return s(e[a][1][t]||t)},d,d.exports,t,e,i,n)}return i[a].exports}for(var o="function"==typeof __require&&__require,a=0;a<n.length;a++)s(n[a]);return s}({AnimationPlayer:[function(t,e){"use strict";cc._RF.push(e,"bab535F10ZK2Iewm/5XRlif","AnimationPlayer"),cc.Class({extends:cc.Component,properties:{bodySpriteNode:cc.Node,shadowSpriteNode:cc.Node,framePath:"",frameRate:12},onLoad:function(){this.bodyFrames=[],this.shadowFrames=[],this._bodyIndex=0,this._shadowIndex=0,this._timer=0,this._isPlaying=!1,this._isPlayingOnce=!1,this._frameInterval=1/this.frameRate,this.bodySprite=this.bodySpriteNode.getComponent(cc.Sprite),this.shadowSprite=this.shadowSpriteNode.getComponent(cc.Sprite),this._loadFrames()},_loadFrames:function(){var t=this;cc.resources.loadDir(this.framePath,cc.SpriteFrame,function(e,i){e?console.error("\u52a0\u8f7d\u5e8f\u5217\u5e27\u5931\u8d25:",e):(i.forEach(function(e){var i=e.name;i.startsWith("body_")?t.bodyFrames.push(e):i.startsWith("shadow_")&&t.shadowFrames.push(e)}),t.bodyFrames.sort(function(t,e){return t.name.localeCompare(e.name)}),t.shadowFrames.sort(function(t,e){return t.name.localeCompare(e.name)}),"pic/game/grandMa"!==t.framePath&&t.play())})},play:function(){this._isPlaying=!0,this._timer=0,this._bodyIndex=0,this._shadowIndex=0,this._isPlayingOnce=!1},playOnce:function(t){var e=t.onFrame,i=t.onComplete;this._isPlaying=!0,this._onFrameCallback=e,this._onCompleteCallback=i,this._timer=0,this._bodyIndex=0,this._shadowIndex=0,this._isPlayingOnce=!0},pause:function(){this._isPlaying=!1},resume:function(){this._isPlaying=!0},update:function(t){this._isPlaying&&(this._timer+=t,this._timer>=this._frameInterval&&(this._timer=0,this.bodyFrames.length>0&&(this._isPlayingOnce&&this._bodyIndex>=this.bodyFrames.length?this.bodySprite.spriteFrame=this.bodyFrames[this.bodyFrames.length-1]:(this.bodySprite.spriteFrame=this.bodyFrames[this._bodyIndex],this._bodyIndex=this._isPlayingOnce?this._bodyIndex+1:(this._bodyIndex+1)%this.bodyFrames.length)),this.shadowFrames.length>0&&(this._isPlayingOnce&&this._shadowIndex>=this.shadowFrames.length?this.shadowSprite.spriteFrame=this.shadowFrames[this.shadowFrames.length-1]:(this.shadowSprite.spriteFrame=this.shadowFrames[this._shadowIndex],this._shadowIndex=this._isPlayingOnce?this._shadowIndex+1:(this._shadowIndex+1)%this.shadowFrames.length)),this._isPlayingOnce))&&(this._bodyIndex,this.bodyFrames.length,this._shadowIndex,this.shadowFrames.length,this._bodyIndex>=3&&this._bodyIndex<8&&"function"==typeof this._onFrameCallback&&this._onFrameCallback(this._bodyIndex)&&(this._onFrameCallback=null),this._bodyIndex>=this.bodyFrames.length&&("function"==typeof this._onCompleteCallback&&this._onCompleteCallback(),this._isPlaying=!1))}}),cc._RF.pop()},{}],TransitionManager:[function(t,e){"use strict";cc._RF.push(e,"37af2ZDITpMp7ROUyoNKEET","TransitionManager"),cc.Class({extends:cc.Component,properties:{fadeNode:cc.Node,fadeDuration:.1},fadeIn:function(t){var e=this;this.fadeNode.active=!0,this.fadeNode.opacity=200,cc.tween(this.fadeNode).to(this.fadeDuration,{opacity:0}).call(function(){e.fadeNode.active=!1,t&&t()}).start()},fadeOut:function(t){this.fadeNode.active=!0,this.fadeNode.opacity=0,cc.tween(this.fadeNode).to(this.fadeDuration,{opacity:200}).call(function(){t&&t()}).start()},transitionToScene:function(t){this.fadeOut(function(){cc.director.loadScene(t,function(){var t=cc.find("Canvas/TransitionLayer");t&&t.getComponent("TransitionManager").fadeIn()})})}}),cc._RF.pop()},{}],chooseScene:[function(t,e){"use strict";cc._RF.push(e,"5cf52OSuJhN8YItCZK7+DO1","chooseScene"),cc.Class({extends:cc.Component,properties:{playButton:cc.Node,TransitionLayer:cc.Node},onLoad:function(){cc.tween(this.playButton).repeatForever(cc.tween().to(.25,{angle:7},{easing:"sineOut"}).to(.25,{angle:-7},{easing:"sineInOut"}).to(.2,{angle:0},{easing:"sineIn"})).start(),this.playButton.on("click",function(){var t=cc.find("Canvas/TransitionLayer");t?t.getComponent("TransitionManager").transitionToScene("loadingScene"):cc.director.loadScene("loadingScene")}),this._preloadGameResources()},_preloadGameResources:function(){["pic/loading"].forEach(function(t){cc.resources.loadDir(t,cc.Asset,function(e,i){e?console.error("\u9884\u52a0\u8f7d "+t+" \u5931\u8d25",e):console.log("\u9884\u52a0\u8f7d\u5b8c\u6210\uff1a"+t,i.length)})})}}),cc._RF.pop()},{}],fitSize:[function(t,e){"use strict";cc._RF.push(e,"6d11a+ucW5JOp/MhRY5CxzY","fitSize"),cc.Class({extends:cc.Component,properties:{designWidth:1920,designHeight:1080},onLoad:function(){this.adaptToScreen()},adaptToScreen:function(){var t=cc.Canvas.instance,e=cc.view.getFrameSize();e.width/e.height>this.designWidth/this.designHeight?(t.fitHeight=!0,t.fitWidth=!1,console.log("\u5c4f\u5e55\u504f\u5bbd\uff0c\u4f7f\u7528\u9ad8\u5ea6\u9002\u914d")):(t.fitHeight=!1,t.fitWidth=!0,console.log("\u5c4f\u5e55\u504f\u7a84\uff0c\u4f7f\u7528\u5bbd\u5ea6\u9002\u914d")),cc.view.setDesignResolutionSize(this.designWidth,this.designHeight,cc.ResolutionPolicy.EXACT_FIT)}}),cc._RF.pop()},{}],gameScene:[function(t,e){"use strict";cc._RF.push(e,"14e91RxabVEq5K0+oFhS7BU","gameScene"),cc.Class({extends:cc.Component,properties:{girlBody:cc.Node,girlShadow:cc.Node,grandmaBody:cc.Node,grandmaShadow:cc.Node,dogBody:cc.Node,dogShadow:cc.Node,mochiNode:cc.Prefab,mochiShowNode:cc.Node,grandmaCtrl:cc.Node,onsetJson:cc.JsonAsset,bgmAudio:cc.AudioClip,hitAudio:cc.AudioClip},onLoad:function(){cc.systemEvent.on(cc.SystemEvent.EventType.KEY_DOWN,this.onKeyDown,this),cc.systemEvent.on(cc.SystemEvent.EventType.KEY_UP,this.onKeyUp,this),this.node.on(cc.Node.EventType.TOUCH_START,this.onTouchStart,this),this._initAnimation(this.girlBody,"pic/game/girl/body"),this._initAnimation(this.girlShadow,"pic/game/girl/shadow"),this._initAnimation(this.dogBody,"pic/game/dog/body"),this._initAnimation(this.dogShadow,"pic/game/dog/shadow"),this._initAnimation(this.grandmaCtrl,"pic/game/grandMa"),this.mochiList=[],this.currentIndex=0,this.timer=0,this.onsets=this.onsetJson.json.onsets,this.spawnLeadTime=2,this.playBGM()},onDestroy:function(){cc.audioEngine.stop(this.bgmId),cc.audioEngine.stop(this.hitId)},onKeyDown:function(t){t.keyCode===cc.macro.KEY.space&&(this.isSpacePressed=!0)},onKeyUp:function(t){t.keyCode===cc.macro.KEY.space&&(this.isSpacePressed=!1)},onTouchStart:function(){this.tryHit()},playBGM:function(){this.bgmId=cc.audioEngine.play(this.bgmAudio,!0,1),this.hitId=cc.audioEngine.play(this.hitAudio,!1,1)},_initAnimation:function(t,e){var i=t.getComponent("AnimationPlayer");i&&(i.framePath=e)},_pauseOrResumeAll:function(t){[this.girlBody,this.girlShadow,this.grandmaBody,this.grandmaShadow,this.dogBody,this.dogShadow].forEach(function(e){var i=e.getComponent("AnimationPlayer");i&&"function"==typeof i[t]&&i[t]()})},update:function(t){for(this.timer+=t;this.currentIndex<this.onsets.length&&this.timer>=this.onsets[this.currentIndex]-this.spawnLeadTime;)this.spawnMochi(this.onsets[this.currentIndex]),this.currentIndex++;this.isSpacePressed&&this.tryHit()},spawnMochi:function(){var t=this,e=cc.instantiate(this.mochiNode),i=e.getComponent("mochi");if(!i)return cc.error("\u9884\u5236\u4f53\u672a\u6302\u8f7d mochi \u7ec4\u4ef6\uff01"),void e.destroy();e.y=540+e.height/2,e.x=0,this.mochiShowNode.addChild(e),i.init(function(i){t.onMochiResult(i,e)}),this.mochiList.push(e)},tryHit:function(){var t=this;this.grandmaCtrl.getComponent("AnimationPlayer").playOnce({onFrame:function(e){return e>=3&&e<7&&t.showHitOnMochi()},onComplete:function(){console.log("\u52a8\u753b\u64ad\u653e\u5b8c\u6bd5")}})},showHitOnMochi:function(){for(var t=!1,e=0;e<this.mochiList.length;e++){var i=this.mochiList[e];if(i&&i.isValid){var n=i.getComponent("mochi");if(n&&n.tryHit()){console.log("mochiHit!"),n.hitShow(),t=!0;break}}}return t},onMochiResult:function(t,e){var i=this.mochiList.indexOf(e);-1!==i&&this.mochiList.splice(i,1),"hit"===t||"miss"!==t&&"finish"!==t||(console.log("Miss! or finish!"),e&&e.isValid&&(e.active=!1,e.destroy()))}}),cc._RF.pop()},{}],loadingScene:[function(t,e){"use strict";cc._RF.push(e,"33bba5Wn4BJn5k5BV1Lj4FQ","loadingScene"),cc.Class({extends:cc.Component,properties:{loadingNode:cc.Node},onLoad:function(){var t=this;this.loadingTime=3,this.frameInterval=.1,this._startTime=Date.now(),this._loadIndex=0,this.loadFrames=[],this.isPlaying=!1,this.timer=0,this.loadSprite=this.loadingNode.getComponent(cc.Sprite),this._loadFrames(),this._preloadGameResources(function(){var e=(Date.now()-t._startTime)/1e3,i=Math.max(t.loadingTime-e,0);t.scheduleOnce(function(){var t=cc.find("Canvas/TransitionLayer");t?t.getComponent("TransitionManager").transitionToScene("gameScene"):cc.director.loadScene("gameScene")},i)})},_loadFrames:function(){var t=this;cc.resources.loadDir("pic/loading",cc.SpriteFrame,function(e,i){e?console.error("\u52a0\u8f7d\u5e8f\u5217\u5e27\u5931\u8d25:",e):(t.loadFrames=i.sort(function(t,e){return Number(t.name)-Number(e.name)}),0!==t.loadFrames.length?(t.isPlaying=!0,t.loadSprite.spriteFrame=t.loadFrames[0]):console.warn("\u672a\u627e\u5230\u4efb\u4f55\u5e8f\u5217\u5e27"))})},_preloadGameResources:function(t){var e=["pic/game/grandMa","pic/game/girl","pic/game/dog"],i=0,n=e.length;e.forEach(function(e){cc.resources.loadDir(e,cc.Asset,function(s,o){s?console.error("\u9884\u52a0\u8f7d "+e+" \u5931\u8d25",s):console.log("\u9884\u52a0\u8f7d\u5b8c\u6210\uff1a"+e,o.length),++i===n&&t&&t()})})},update:function(t){this.isPlaying&&0!==this.loadFrames.length&&(this.timer+=t,this.timer>=this.frameInterval&&(this.timer=0,this._loadIndex=(this._loadIndex+1)%this.loadFrames.length,this.loadSprite.spriteFrame=this.loadFrames[this._loadIndex],console.log("\u9884\u52a0\u8f7dindex:"+this._loadIndex)))}}),cc._RF.pop()},{}],mainScene:[function(t,e){"use strict";cc._RF.push(e,"280c3rsZJJKnZ9RqbALVwtK","mainScene"),cc.Class({extends:cc.Component,properties:{title:cc.Node,showNode:cc.Node,startBtn:cc.Button},onLoad:function(){this.startBtn.node.on("click",this.onStartGame,this),cc.tween(this.title).repeatForever(cc.tween().to(1.2,{y:this.title.y+15},{easing:"sineInOut"}).to(1.2,{y:this.title.y-15},{easing:"sineInOut"})).start(),this.showNode.opacity=180,cc.tween(this.showNode).repeatForever(cc.tween().to(.8,{x:this.showNode.x+3},{easing:"sineInOut"}).to(.8,{x:this.showNode.x-3},{easing:"sineInOut"}).to(.8,{y:this.showNode.y+3},{easing:"sineInOut"}).to(.8,{y:this.showNode.y-3},{easing:"sineInOut"})).start();var t=this.startBtn.node;cc.tween(t).repeatForever(cc.tween().to(.25,{angle:3},{easing:"sineOut"}).to(.25,{angle:-3},{easing:"sineInOut"}).to(.2,{angle:0},{easing:"sineIn"})).start()},onStartGame:function(){var t=cc.find("Canvas/TransitionLayer");t?t.getComponent("TransitionManager").transitionToScene("chooseScene"):cc.director.loadScene("chooseScene")}}),cc._RF.pop()},{}],mochi:[function(t,e){"use strict";cc._RF.push(e,"8ffccMhszVGhI6+CSop4oc4","mochi"),cc.Class({extends:cc.Component,properties:{sprite:cc.Sprite,hitAnimFrames:{default:[],type:cc.SpriteFrame},speed:220,hitRange:20,hitY:-320},onLoad:function(){this.isHit=!1,this.callback=null,this._currentFrame=0,this._isPlayingHitAnim=!1},init:function(t){this.callback=t},update:function(t){if(this.node.y-=this.speed*t,this._isPlayingHitAnim){this._currentFrame+=12*t;var e=Math.floor(this._currentFrame);return e>=this.hitAnimFrames.length?(this._isPlayingHitAnim=!1,void(this.callback&&this.callback("finish",this.node))):void(this.sprite.spriteFrame=this.hitAnimFrames[e])}this.node.y<=this.hitY-this.hitRange&&(this.isHit=!0,this.callback&&this.callback("miss",this.node))},tryHit:function(){return!this.isHit&&Math.abs(this.node.y-this.hitY)<=this.hitRange&&(this.isHit=!0,this.callback&&this.callback("hit",this.node),!0)},hitShow:function(){this._isPlayingHitAnim=!0,this._currentFrame=0}}),cc._RF.pop()},{}],pvScene:[function(t,e){"use strict";cc._RF.push(e,"abce10RBiZJdaynk27QUUjh","pvScene"),cc.Class({extends:cc.Component,properties:{spriteNode:cc.Node,frameRate:30},onLoad:function(){var t=this;this.totalFrames=90,this.currentFrame=0,this.frames=[],this.isPlaying=!1,this.isLoaded=!1,this.sprite=this.spriteNode.getComponent(cc.Sprite),this.preloadFrames(function(){t.isLoaded=!0,console.log("\u6240\u6709\u5e27\u52a0\u8f7d\u5b8c\u6210"),t.startPlayback()})},preloadFrames:function(t){for(var e=this,i=0,n=function(n){var s="pvImage/"+n;cc.resources.load(s,cc.SpriteFrame,function(o,a){o?console.warn("\u52a0\u8f7d\u5931\u8d25: "+s,o):e.frames[n-1]=a,++i===e.totalFrames&&t&&t()})},s=1;s<=this.totalFrames;s++)n(s)},startPlayback:function(){this.isLoaded&&!this.isPlaying&&(this.isPlaying=!0,this.schedule(this.playNextFrame,1/this.frameRate))},playNextFrame:function(){this.currentFrame>=this.frames.length?this.finishPlayback():(this.sprite.spriteFrame=this.frames[this.currentFrame],this.currentFrame++)},finishPlayback:function(){var t=this;this.unschedule(this.playNextFrame),console.log("\u64ad\u653e\u5b8c\u6bd5\uff0c\u51c6\u5907\u5207\u573a\u666f"),this.sprite.spriteFrame=this.frames[this.frames.length-1],cc.director.preloadScene("mainScene",function(){console.log("\u573a\u666f\u9884\u52a0\u8f7d\u5b8c\u6210\uff0c\u5207\u6362\u4e2d..."),cc.director.loadScene("mainScene",function(){t.releaseResources()})})},releaseResources:function(){this.frames.forEach(function(t){t&&cc.assetManager.releaseAsset(t)}),this.frames.length=0}}),cc._RF.pop()},{}]},{},["AnimationPlayer","TransitionManager","chooseScene","fitSize","gameScene","loadingScene","mainScene","mochi","pvScene"]);